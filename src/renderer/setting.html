<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Voice Control Desktop - Setting</title>
</head>
<body>

<div class="etabs-tabgroup">
  <div class="etabs-tabs"></div>
  <div class="etabs-buttons"></div>
</div>
<div class="etabs-views" style="display: none; clear: left"></div>
<div id="padding" style="clear: left"></div>

<div id="network" class="setting-body">
  <div class="setting-contents">
    <form id="network-settings" name="settings" action="">
      <label for="network-ipaddr">IP address:</label>
      <input placeholder="host ip address" id="network-ipaddr" type=text value="">
      <label for="network-port">Port number:</label>
      <input placeholder="port number" id="network-port" type=text value="">
    </form>
    <hr>
    <label for="network-url">Host URL:</label>
    <p id="network-url"></p><br />
    <label for="network-qrcode">QR code:</label>
    <div id="network-qrcode"></div>
  </div>
</div>
<div id="buttons" class="setting-body">
  <div class="header">
    <div class="target-selection" id="buttons-targetType"></div>
  </div>
  <div id="buttons-table" class="setting-contents"></div>
</div>
<div id="replacer" class="setting-body">
  <div class="header">
    <div class="target-selection" id="replacer-targetType"></div>
  </div>
  <div id="replacer-table" class="setting-contents">
  </div>
</div>

<script type="text/javascript" src="./bundle/renderer.js"></script>
<script type="text/javascript">
  var { ipcRenderer } = require('electron')
  const TabGroup = require('electron-tabs')
  tabGroup = new TabGroup();

  networkSetting = tabGroup.addTab({
    title: 'Network',
    src: './empty.html',
    visible: true,
    closable: false,
  });
  replacerSetting = tabGroup.addTab({
    title: 'Replacer',
    src: './empty.html',
    visible: true,
    closable: false
  });
  buttonsSetting = tabGroup.addTab({
    title: 'Buttons',
    src: './empty.html',
    visible: true,
    closable: false
  });

  function onTabChange(tabName) {
    document.getElementById('network').style.display = tabName == 'Network' ? 'block' : 'none'
    document.getElementById('buttons').style.display = tabName == 'Buttons' ? 'block' : 'none'
    document.getElementById('replacer').style.display = tabName == 'Replacer' ? 'block' : 'none'
    ipcRenderer.send('tab-active', tabName)
  }

  tabGroup.on('tab-active', (tab, tabGroup) => onTabChange(tab.getTitle()))
  networkSetting.activate()
</script>

<script type="text/javascript">
  function networkApply() {
    updateHostUrl()

    hostURL = document.getElementById('network-url').innerText
    localIPAddress = document.getElementById('network-ipaddr').value
    portNo = document.getElementById('network-port').value
    newSettings = {
      hostURL: `https://${localIPAddress}:${portNo}`,
      hostIPAddress: localIPAddress,
      portNo: portNo
    }
    ipcRenderer.send('network-apply', newSettings);
  }
  function setHostUrl(host, port) {
    document.getElementById('network-ipaddr').value = host
    document.getElementById('network-port').value = port
    updateHostUrl()
  }
  function updateHostUrl() {
    var url = 'https://' + document.getElementById('network-ipaddr').value + ':' + document.getElementById('network-port').value;
    document.getElementById('network-url').innerText = url;
    loadComponent('QrCode', document.getElementById('network-qrcode'), { text: url })
  }
  document.getElementById('network-ipaddr').onchange = networkApply;
  document.getElementById('network-port').onchange = networkApply;
  window.onunload = networkApply;
</script>

<script type="text/javascript">
  var newButtonSetting

  function onButtonsChange(buttonSetting)
  {
    newButtonSetting = buttonSetting
    ipcRenderer.send('buttons-apply', newButtonSetting);
  }

  function onButtonsTargetTypeChange(targetType)
  {
    ipcRenderer.send('buttons-targettype', targetType)
  }

  function setButtonSetting(buttonSetting, targetTypes, currentTargetType)
  {
    newButtonSetting = buttonSetting
    loadComponent('ButtonSettingRoot', document.getElementById('buttons-table'), {buttonSetting: buttonSetting, onChange: onButtonsChange, key: currentTargetType})
    loadComponent('TargetTypeSelection', document.getElementById('buttons-targetType'), {targetTypes: targetTypes, value: currentTargetType, onChange: onButtonsTargetTypeChange, key: currentTargetType})
  }
</script>

<script type="text/javascript">
  var newReplacerSetting

  function onReplacerChange(replacerSetting)
  {
    newReplacerSetting = replacerSetting
    ipcRenderer.send('replacer-apply', newReplacerSetting);
  }

  function onReplacerTargetTypeChange(targetType)
  {
    ipcRenderer.send('replacer-targettype', targetType)
  }

  function setReplacer(replacerSetting, targetTypes, currentTargetType)
  {
    newReplacerSetting = replacerSetting
    loadComponent('ReplacerSettingRoot', document.getElementById('replacer-table'), {replacerSetting: replacerSetting, onChange: onReplacerChange, key: currentTargetType})
    loadComponent('TargetTypeSelection', document.getElementById('replacer-targetType'), {targetTypes: targetTypes, value: currentTargetType, onChange: onReplacerTargetTypeChange, key: currentTargetType})
  }
</script>

</body>
</html>